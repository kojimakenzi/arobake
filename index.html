<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ARç”»åƒè¡¨ç¤ºã‚¢ãƒ—ãƒª</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.4.2/aframe/build/aframe-ar.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .info {
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }
        .info h1 {
            margin: 0 0 10px 0;
            font-size: 24px;
        }
        .info p {
            margin: 5px 0;
            font-size: 14px;
            line-height: 1.6;
        }
        .marker-info {
            margin-top: 10px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
        }
        .stamp-rally {
            margin-top: 10px;
            padding: 10px;
            background: rgba(76, 175, 80, 0.2);
            border-radius: 5px;
            border: 2px solid rgba(76, 175, 80, 0.5);
        }
        .stamp-item {
            display: inline-block;
            margin: 5px;
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            font-size: 12px;
        }
        .stamp-item.collected {
            background: rgba(76, 175, 80, 0.5);
            border: 2px solid rgba(76, 175, 80, 1);
        }
        .prize {
            margin-top: 15px;
            padding: 15px;
            background: rgba(255, 193, 7, 0.3);
            border-radius: 5px;
            border: 2px solid rgba(255, 193, 7, 0.8);
            text-align: center;
            display: none;
        }
        .prize.show {
            display: block;
            animation: bounce 0.5s;
        }
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
    </style>
</head>
<body>
    <!--
    <div class="info">
        <h1>ğŸ‘» ARç”»åƒè¡¨ç¤ºã‚¢ãƒ—ãƒª</h1>
        <p>ã‚«ãƒ¡ãƒ©ã‚’ARãƒãƒ¼ã‚«ãƒ¼ã«å‘ã‘ã¦ãã ã•ã„</p>
        <div class="marker-info">
            <p><strong>ä½¿ã„æ–¹ï¼š</strong></p>
            <p>1. ãƒãƒ¼ã‚«ãƒ¼ç”»åƒï¼ˆarmarker.pngï¼‰ã‚’å°åˆ·ã¾ãŸã¯ç”»é¢ã«è¡¨ç¤º</p>
            <p>2. ã‚«ãƒ¡ãƒ©ã®ã‚¢ã‚¯ã‚»ã‚¹è¨±å¯ã‚’è¨±å¯ã—ã¦ãã ã•ã„</p>
            <p>3. ã‚«ãƒ¡ãƒ©ã‚’ãƒãƒ¼ã‚«ãƒ¼ã«å‘ã‘ã‚‹ã¨ç”»åƒãŒè¡¨ç¤ºã•ã‚Œã¾ã™</p>
        </div>
        <div class="stamp-rally">
            <p><strong>ğŸ“‹ ã‚¹ã‚¿ãƒ³ãƒ—ãƒ©ãƒªãƒ¼</strong></p>
            <div id="stamp-list"></div>
            <div class="prize" id="prize">
                <h2>ğŸ‰ ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼</h2>
                <p>å…¨ã¦ã®ãƒãƒ¼ã‚«ãƒ¼ã‚’èª­ã¿å–ã‚Šã¾ã—ãŸï¼</p>
                <p>æ™¯å“: ç‰¹åˆ¥ãªARä½“é¨“ãŒè§£æ”¾ã•ã‚Œã¾ã—ãŸï¼</p>
            </div>
        </div>
    </div>
    -->

    <a-scene
        vr-mode-ui="enabled: false"
        renderer="logarithmicDepthBuffer: true;"
        embedded
        arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3; cameraParametersUrl: https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.4.2/data/data/camera_para.dat; maxDetectionRate: 60; canvasWidth: 640; canvasHeight: 480;"
    >
        <!-- ãƒãƒ¼ã‚«ãƒ¼1 -->
        <a-marker
            type="pattern"
            preset="custom"
            url="images/armarker.patt"
            raycaster="objects: .clickable"
            emitevents="true"
            cursor="fuse: false; rayOrigin: mouse;"
            id="marker1"
            data-marker-id="marker1"
            data-marker-name="ãƒãƒ¼ã‚«ãƒ¼1"
        >
            <!-- è¡¨ç¤ºã™ã‚‹ç”»åƒ -->
            <a-image
                src="images/obake01.png"
                position="0 0 0"
                rotation="-90 0 0"
                scale="1 1 1"
                class="clickable"
            ></a-image>
            <!-- ãƒ†ã‚­ã‚¹ãƒˆè¡¨ç¤º -->
            <a-text
                value="ä»Šã™ãå‡ºã¦è¡Œã‘ï¼ï¼"
                position="0 0.5 0"
                rotation="-90 0 0"
                align="center"
                color="#FFFFFF"
                scale="0.5 0.5 0.5"
            ></a-text>
        </a-marker>

        <!-- ãƒãƒ¼ã‚«ãƒ¼2ï¼ˆè¿½åŠ ã®ãƒãƒ¼ã‚«ãƒ¼ãŒã‚ã‚‹å ´åˆã€åˆ¥ã®.pattãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”¨æ„ï¼‰ -->
    
        <a-marker
            type="pattern"
            preset="custom"
            url="images/pattern-marker2.patt"
            raycaster="objects: .clickable"
            emitevents="true"
            cursor="fuse: false; rayOrigin: mouse;"
            id="marker2"
            data-marker-id="marker2"
            data-marker-name="ãƒãƒ¼ã‚«ãƒ¼2"
        >
            <a-image
                src="images/obake02.png"
                position="0 0 0"
                rotation="-90 0 0"
                scale="1 1 1"
                class="clickable"
            ></a-image>
        </a-marker>


        <!-- ã‚«ãƒ¡ãƒ© -->
        <a-entity camera></a-entity>
    </a-scene>

    <script>
        // ã‚¹ã‚¿ãƒ³ãƒ—ãƒ©ãƒªãƒ¼ç®¡ç†ã‚¯ãƒ©ã‚¹
        class StampRally {
            constructor() {
                this.storageKey = 'ar_stamp_rally';
                this.markers = [];
                this.collectedMarkers = this.loadCollectedMarkers();
                this.initMarkers();
                this.updateStampDisplay();
            }

            // LocalStorageã‹ã‚‰èª­ã¿å–ã£ãŸãƒãƒ¼ã‚«ãƒ¼ã‚’èª­ã¿è¾¼ã‚€
            loadCollectedMarkers() {
                const stored = localStorage.getItem(this.storageKey);
                return stored ? JSON.parse(stored) : [];
            }

            // LocalStorageã«ä¿å­˜
            saveCollectedMarkers() {
                localStorage.setItem(this.storageKey, JSON.stringify(this.collectedMarkers));
            }

            // ãƒãƒ¼ã‚«ãƒ¼ã‚’åˆæœŸåŒ–
            initMarkers() {
                const markerElements = document.querySelectorAll('a-marker[data-marker-id]');
                markerElements.forEach(marker => {
                    const markerId = marker.getAttribute('data-marker-id');
                    const markerName = marker.getAttribute('data-marker-name') || markerId;
                    
                    this.markers.push({
                        id: markerId,
                        name: markerName,
                        element: marker
                    });

                    // ãƒãƒ¼ã‚«ãƒ¼æ¤œå‡ºã‚¤ãƒ™ãƒ³ãƒˆ
                    marker.addEventListener('markerFound', () => {
                        this.onMarkerFound(markerId, markerName);
                    });
                });
            }

            // ãƒãƒ¼ã‚«ãƒ¼æ¤œå‡ºæ™‚ã®å‡¦ç†
            onMarkerFound(markerId, markerName) {
                if (!this.collectedMarkers.includes(markerId)) {
                    this.collectedMarkers.push(markerId);
                    this.saveCollectedMarkers();
                    this.updateStampDisplay();
                    console.log(`âœ… ${markerName} ã‚’è¨˜éŒ²ã—ã¾ã—ãŸï¼`);
                    
                    // å…¨ã¦ã®ãƒãƒ¼ã‚«ãƒ¼ã‚’èª­ã¿å–ã£ãŸã‹ãƒã‚§ãƒƒã‚¯
                    if (this.checkAllCollected()) {
                        this.showPrize();
                    }
                }
            }

            // å…¨ã¦ã®ãƒãƒ¼ã‚«ãƒ¼ã‚’èª­ã¿å–ã£ãŸã‹ãƒã‚§ãƒƒã‚¯
            checkAllCollected() {
                return this.markers.length > 0 && 
                       this.markers.every(marker => this.collectedMarkers.includes(marker.id));
            }

            // ã‚¹ã‚¿ãƒ³ãƒ—è¡¨ç¤ºã‚’æ›´æ–°
            updateStampDisplay() {
                const stampList = document.getElementById('stamp-list');
                stampList.innerHTML = '';

                this.markers.forEach(marker => {
                    const isCollected = this.collectedMarkers.includes(marker.id);
                    const stampItem = document.createElement('div');
                    stampItem.className = `stamp-item ${isCollected ? 'collected' : ''}`;
                    stampItem.textContent = isCollected ? `âœ“ ${marker.name}` : `â—‹ ${marker.name}`;
                    stampList.appendChild(stampItem);
                });

                // é€²æ—è¡¨ç¤º
                const progress = document.createElement('p');
                progress.style.marginTop = '10px';
                progress.style.fontSize = '12px';
                progress.textContent = `é€²æ—: ${this.collectedMarkers.length}/${this.markers.length}`;
                stampList.appendChild(progress);
            }

            // æ™¯å“è¡¨ç¤º
            showPrize() {
                const prize = document.getElementById('prize');
                prize.classList.add('show');
                console.log('ğŸ‰ å…¨ã¦ã®ãƒãƒ¼ã‚«ãƒ¼ã‚’èª­ã¿å–ã‚Šã¾ã—ãŸï¼');
            }

            // ãƒªã‚»ãƒƒãƒˆæ©Ÿèƒ½ï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰
            reset() {
                localStorage.removeItem(this.storageKey);
                this.collectedMarkers = [];
                this.updateStampDisplay();
                document.getElementById('prize').classList.remove('show');
                console.log('ã‚¹ã‚¿ãƒ³ãƒ—ãƒ©ãƒªãƒ¼ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸ');
            }
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«åˆæœŸåŒ–
        window.addEventListener('DOMContentLoaded', () => {
            const stampRally = new StampRally();
            
            // ãƒ‡ãƒãƒƒã‚°ç”¨ï¼šã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ reset() ã‚’å®Ÿè¡Œã™ã‚‹ã¨ãƒªã‚»ãƒƒãƒˆå¯èƒ½
            window.stampRally = stampRally;
        });
    </script>
</body>
</html>

